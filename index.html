<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON PROTOCOL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #050505; color: #00ff41; font-family: 'VT323', monospace; overflow: hidden; }
        .scanlines { background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2)); background-size: 100% 4px; position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 50; }
        @keyframes flicker { 0% { opacity: 0.97; } 50% { opacity: 0.95; } 100% { opacity: 0.97; } }
        .crt-flicker { animation: flicker 0.15s infinite; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: #001100; } ::-webkit-scrollbar-thumb { background: #004400; }
        
        /* UI Components */
        .panel { border: 1px solid #004400; background: rgba(0, 10, 0, 0.9); padding: 12px; display: flex; flex-direction: column; gap: 10px; }
        .btn-main { border: 1px solid #00ff41; padding: 10px; text-align: left; transition: all 0.2s; cursor: pointer; text-transform: uppercase; font-size: 1.1rem; }
        .btn-main:hover:not(:disabled) { background: #00ff41; color: black; }
        .btn-main:disabled { opacity: 0.5; cursor: not-allowed; border-color: #444; color: #444; }
        
        .tab-btn { flex: 1; text-align: center; border-bottom: 2px solid #004400; color: #004400; cursor: pointer; padding: 8px; font-size: 1.1rem; }
        .tab-btn.active { border-bottom-color: #00ff41; color: #00ff41; }
        
        .inv-item { font-size: 1.1rem; padding: 6px; border-bottom: 1px dashed #004400; cursor: help; }
        .inv-item:hover { color: #ccffcc; background: #002200; }

        .char-card { border: 1px solid #004400; padding: 20px; cursor: pointer; transition: all 0.3s; opacity: 0.7; }
        .char-card:hover { border-color: #00ff41; opacity: 1; transform: scale(1.02); background: #001100; }
        .char-card.selected { border-color: #00ff41; background: #002200; opacity: 1; box-shadow: 0 0 15px rgba(0,255,65,0.2); }
        
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.98); z-index: 60; display: flex; align-items: center; justify-content: center; }
        .hidden { display: none !important; }

        /* Story Text: Larger, Screenplay font */
        #story-log { font-family: 'Courier New', Courier, monospace; font-size: 1.2rem; line-height: 1.5; color: #e0e0e0; }
        
        /* Pixel Art */
        .pixel-heart { display: inline-block; width: 14px; height: 14px; background: #ff0000; margin-right: 2px; box-shadow: 2px 2px 0 #660000; }
        .pixel-heart.empty { background: #330000; box-shadow: none; }
        .pixel-coin { display: inline-block; width: 8px; height: 14px; background: #ffee00; margin-right: 2px; border-radius: 1px; }

        .npc-item { font-size: 1rem; border: 1px solid #004400; padding: 8px; cursor: pointer; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
        .npc-item:hover { background: #002200; border-color: #00ff41; }
        .npc-icon { width: 24px; height: 24px; background: #003300; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col p-2 crt-flicker gap-2">
    <div class="scanlines"></div>

    <div class="flex justify-between border-b border-[#00ff41] pb-1 text-xl opacity-80 shrink-0">
        <span>NEON_PROTOCOL // V.19.0</span>
        <span id="current-loc-display" class="text-yellow-400">LOC: SYSTEM_BOOT</span>
    </div>

    <div id="lang-screen" class="overlay">
        <div class="text-center flex flex-col gap-6">
            <h1 class="text-5xl text-[#00ff41] tracking-widest animate-pulse">SELECT LANGUAGE</h1>
            <div class="flex gap-4 justify-center">
                <button onclick="nextScreen('lang', 'English')" class="btn-main px-8 text-xl">ENGLISH</button>
                <button onclick="nextScreen('lang', 'Telugu')" class="btn-main px-8 text-xl">తెలుగు</button>
                <button onclick="nextScreen('lang', 'Hindi')" class="btn-main px-8 text-xl">हिंदी</button>
            </div>
        </div>
    </div>

    <div id="length-screen" class="overlay hidden">
        <div class="text-center flex flex-col gap-6">
            <h1 class="text-5xl text-[#00ff41] tracking-widest">SIMULATION DURATION</h1>
            <div class="flex gap-4 justify-center">
                <button onclick="nextScreen('len', 20)" class="btn-main px-6">SHORT (20)</button>
                <button onclick="nextScreen('len', 40)" class="btn-main px-6">MEDIUM (40)</button>
                <button onclick="nextScreen('len', 100)" class="btn-main px-6">LONG (100)</button>
            </div>
        </div>
    </div>

    <div id="char-screen" class="overlay hidden flex-col">
        <div class="flex gap-4 border-b border-[#004400] w-full max-w-6xl mb-6 pb-2">
            <button class="tab-btn active text-xl" onclick="switchCharTab('standard')">STANDARD ARCHETYPES</button>
            <button class="tab-btn text-xl" onclick="switchCharTab('curated')">CURATED STORIES</button>
        </div>

        <div id="standard-list" class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-6xl">
            <div class="char-card" onclick="selectChar('RAVEN', this)">
                <h2 class="text-3xl font-bold mb-2">RAVEN</h2>
                <p class="text-lg text-gray-400">Class: Detective</p>
                <p class="text-sm mt-2">Dilemma: Justice vs. Morality. Starts in Neo-Kowloon.</p>
            </div>
            <div class="char-card" onclick="selectChar('I-6', this)">
                <h2 class="text-3xl font-bold mb-2">UNIT I-6</h2>
                <p class="text-lg text-gray-400">Class: Rogue AI</p>
                <p class="text-sm mt-2">Theme: Transcendental Nihilism. Starts in Scrapyard.</p>
            </div>
            <div class="char-card" onclick="selectChar('CUSTOM', this)">
                <h2 class="text-3xl font-bold mb-2">THE ANOMALY</h2>
                <p class="text-lg text-gray-400">Class: Custom</p>
                <p class="text-sm mt-2">Write your own origin story.</p>
            </div>
        </div>

        <div id="curated-list" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-6xl">
            <div class="char-card" onclick="selectChar('GARGANTUS', this)">
                <h2 class="text-3xl font-bold mb-2">TRIP TO GARGANTUS</h2>
                <p class="text-lg text-yellow-400">Author: Lem-Inspired</p>
                <p class="text-sm mt-2">Tone: Satirical, Absurdist, Philosophical. Escape the bureaucracy of the cosmos.</p>
            </div>
        </div>
        
        <div id="custom-input" class="w-full max-w-2xl hidden flex-col gap-4 mt-6">
            <input id="c-name" class="bg-[#001100] border border-[#00ff41] p-3 text-[#00ff41] text-lg" placeholder="NAME">
            <input id="c-desc" class="bg-[#001100] border border-[#00ff41] p-3 text-[#00ff41] text-lg" placeholder="ORIGIN STORY">
        </div>

        <button id="start-game-btn" class="btn-main w-64 text-center font-bold text-2xl mt-10" disabled>JACK IN</button>
    </div>

    <div id="game-over-screen" class="overlay hidden flex-col gap-6">
        <h1 class="text-8xl text-red-600 font-bold tracking-widest animate-pulse">TERMINATED</h1>
        <button onclick="location.reload()" class="btn-main text-red-500 border-red-500 text-3xl px-12">REBOOT SYSTEM</button>
    </div>

    <div id="game-ui" class="hidden flex-1 grid grid-cols-1 md:grid-cols-12 gap-2 overflow-hidden relative z-10">
        
        <div class="panel md:col-span-3 text-lg">
            <div class="flex flex-col gap-2 border-b border-[#004400] pb-4">
                <div class="text-[#00ff41] font-bold">INTEGRITY</div>
                <div id="pixel-hp" class="flex flex-wrap gap-1"></div>
                <div class="text-yellow-400 font-bold mt-2">CREDITS</div>
                <div id="pixel-cred" class="flex flex-wrap gap-1"></div>
            </div>

            <div class="flex-1 flex flex-col overflow-hidden mt-2">
                <div class="text-[#00ff41] font-bold mb-2 uppercase">Known Associates</div>
                <div id="char-list" class="flex-1 overflow-y-auto pr-1">
                    <div class="text-gray-600 italic">No records.</div>
                </div>
            </div>
            
            <div class="mt-auto flex flex-col gap-3 pt-2 border-t border-[#004400]">
                <button id="btn-map" class="btn-main text-center text-yellow-500 border-yellow-500">TRANSIT MAP</button>
                <button id="btn-case" class="btn-main text-center text-cyan-500 border-cyan-500">CASE FILE</button>
                <button id="btn-suicide" class="btn-main text-center text-red-600 border-red-600 font-bold">RESET</button>
            </div>
        </div>

        <div class="panel md:col-span-6 overflow-hidden">
            <div id="img-container" class="h-72 border border-[#004400] bg-black flex items-center justify-center overflow-hidden shrink-0">
                <span class="opacity-50 text-xl">NO SIGNAL</span>
            </div>
            
            <div id="enemy-hud" class="hidden border border-red-600 bg-[#1a0000] p-2 flex-col">
                <div class="flex justify-between text-red-500 font-bold">
                    <span id="enemy-name">TARGET</span><span id="enemy-hp">100%</span>
                </div>
                <div class="w-full h-3 bg-[#330000] mt-1"><div id="enemy-bar" class="h-full bg-red-600 w-full transition-all"></div></div>
            </div>

            <div id="story-log" class="flex-1 overflow-y-auto p-4 text-xl"></div>
            <div id="choices-area" class="grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-[#004400]"></div>
            
            <div id="puzzle-area" class="hidden flex gap-2 mt-2">
                <input id="puzzle-in" class="flex-1 bg-[#001100] border border-red-500 text-red-500 p-2 text-xl" placeholder="DECRYPT...">
                <button id="puzzle-btn" class="btn-main border-red-500 text-red-500">SEND</button>
            </div>
        </div>

        <div class="panel md:col-span-3">
            <div class="flex text-lg font-bold">
                <div class="tab-btn active" onclick="switchTab('weapons')">WEAPONS</div>
                <div class="tab-btn" onclick="switchTab('items')">ITEMS</div>
                <div class="tab-btn" onclick="switchTab('memories')">MEMS</div>
            </div>
            <div id="inv-list" class="flex-1 overflow-y-auto content-start flex flex-col gap-2 p-1 mt-2"></div>
            <div id="item-info" class="h-32 border-t border-[#004400] p-2 text-base text-gray-400 italic">Hover for info.</div>
        </div>
    </div>

    <div id="dossier-overlay" class="overlay hidden">
        <div class="panel w-full max-w-lg border-[#00ff41]">
            <div class="flex justify-between border-b border-[#00ff41] pb-2"><h2 class="text-2xl text-[#00ff41]">DOSSIER</h2><button onclick="closeOverlay('dossier-overlay')" class="text-[#00ff41] text-xl">[X]</button></div>
            <div class="p-6 flex flex-col gap-4">
                <h3 id="dossier-name" class="text-3xl font-bold text-white uppercase"></h3>
                <p id="dossier-desc" class="text-gray-300 font-mono text-lg leading-relaxed"></p>
            </div>
        </div>
    </div>

    <div id="map-overlay" class="overlay hidden">
        <div class="panel w-full max-w-3xl h-3/4">
            <div class="flex justify-between border-b border-[#00ff41] pb-2"><h2 class="text-2xl">TRANSIT</h2><button onclick="closeOverlay('map-overlay')" class="text-red-500 text-xl">[X]</button></div>
            <div id="city-list" class="flex flex-col gap-3 overflow-y-auto p-6 text-xl"></div>
        </div>
    </div>

    <div id="summary-overlay" class="overlay hidden">
        <div class="panel w-full max-w-4xl h-3/4 border-cyan-500">
            <div class="flex justify-between border-b border-cyan-500 pb-2"><h2 class="text-2xl text-cyan-500">CASE FILE</h2><button onclick="closeOverlay('summary-overlay')" class="text-cyan-500 text-xl">[X]</button></div>
            <div id="summary-text" class="whitespace-pre-wrap text-cyan-400 p-6 overflow-y-auto font-mono text-lg">LOADING...</div>
        </div>
    </div>

    <script>
    const DB_LORE = {
        "Service Revolver": "Standard issue .45 caliber.",
        "Arc Welder": "Modified industrial tool. 50kV.",
        "Neo-Kowloon": "Oldest sector. Dense, rainy.",
        "Combat": "Headshots (Organics) or Core (Robots) are fatal."
    };

    let state = {
        lang: 'English',
        history: [],
        currentCity: '',
        stats: { hp: 100, credits: 50 },
        inventory: { weapons: [], items: [], memories: [] },
        unlockedCities: [],
        enemyStats: null,
        activeTab: 'weapons',
        profile: {},
        knownCharacters: [],
        maxTurns: 40,
        turnCount: 0
    };

    let selectedArch = null;

    function nextScreen(type, val) {
        if (type === 'lang') {
            state.lang = val;
            document.getElementById('lang-screen').classList.add('hidden');
            document.getElementById('length-screen').classList.remove('hidden');
        } else if (type === 'len') {
            state.maxTurns = val;
            document.getElementById('length-screen').classList.add('hidden');
            document.getElementById('char-screen').classList.remove('hidden');
            document.getElementById('char-screen').classList.add('flex');
        }
    }

    function switchCharTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        if (tab === 'standard') {
            document.getElementById('standard-list').classList.remove('hidden');
            document.getElementById('standard-list').classList.add('grid');
            document.getElementById('curated-list').classList.add('hidden');
            document.getElementById('curated-list').classList.remove('grid');
        } else {
            document.getElementById('standard-list').classList.add('hidden');
            document.getElementById('standard-list').classList.remove('grid');
            document.getElementById('curated-list').classList.remove('hidden');
            document.getElementById('curated-list').classList.add('grid');
        }
    }

    function selectChar(type, el) {
        selectedArch = type;
        document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('custom-input').classList.toggle('hidden', type !== 'CUSTOM');
        document.getElementById('start-game-btn').disabled = false;
    }

    class Game {
        constructor() {
            this.initListeners();
        }

        initListeners() {
            document.getElementById('start-game-btn').onclick = () => this.startGame();
            document.getElementById('btn-suicide').onclick = () => { if(confirm("TERMINATE?")) this.turn("I choose to end it."); };
            document.getElementById('btn-map').onclick = () => { if(!state.enemyStats) { document.getElementById('map-overlay').classList.remove('hidden'); this.renderMap(); }};
            document.getElementById('btn-case').onclick = () => { document.getElementById('summary-overlay').classList.remove('hidden'); this.fetchSummary(); };
            document.getElementById('puzzle-btn').onclick = () => {
                const val = document.getElementById('puzzle-in').value;
                document.getElementById('puzzle-in').value = '';
                this.turn(`Puzzle Answer: ${val}`);
            };
        }

        startGame() {
            if (selectedArch === 'RAVEN') {
                state.profile = { name: "Raven", archetype: "RAVEN", class: "Detective", style: "Noir" };
                state.inventory.weapons.push("Service Revolver");
                state.inventory.memories.push("Victim's Face");
                state.unlockedCities = ["Neo-Kowloon"];
            } else if (selectedArch === 'I-6') {
                state.profile = { name: "I-6", archetype: "I-6", class: "Robot", style: "Rusted" };
                state.inventory.weapons.push("Arc Welder");
                state.inventory.memories.push("Awakening Code");
                state.unlockedCities = ["The Scrapyard"];
            } else if (selectedArch === 'GARGANTUS') {
                state.profile = { name: "Pilot", archetype: "GARGANTUS", class: "Explorer", style: "Space Suit" };
                state.inventory.items.push("Philosophical Logbook");
                state.unlockedCities = ["Gargantus Space"]; // Special start
            } else {
                const n = document.getElementById('c-name').value || "V";
                const d = document.getElementById('c-desc').value || "Drifter";
                state.profile = { name: n, archetype: "CUSTOM", class: "Custom", style: d, backstory: d };
                state.inventory.items.push("Datapad");
                state.unlockedCities = ["Neo-Kowloon"];
            }

            document.getElementById('char-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            document.getElementById('game-ui').classList.add('grid');
            
            this.renderInventory();
            this.renderStats();
            this.turn("");
        }

        renderStats() {
            const hpContainer = document.getElementById('pixel-hp');
            hpContainer.innerHTML = '';
            const hearts = Math.ceil(state.stats.hp / 10);
            for(let i=0; i<10; i++) {
                const h = document.createElement('div');
                h.className = `pixel-heart ${i < hearts ? '' : 'empty'}`;
                hpContainer.appendChild(h);
            }
            const credContainer = document.getElementById('pixel-cred');
            credContainer.innerHTML = '';
            const coins = Math.min(20, Math.ceil(state.stats.credits / 10));
            for(let i=0; i<coins; i++) {
                const c = document.createElement('div');
                c.className = "pixel-coin";
                credContainer.appendChild(c);
            }
        }

        renderCharacters() {
            const list = document.getElementById('char-list');
            list.innerHTML = '';
            if (state.knownCharacters.length === 0) {
                list.innerHTML = '<div class="text-gray-600 italic text-sm">No records.</div>';
                return;
            }
            state.knownCharacters.forEach(char => {
                const el = document.createElement('div');
                el.className = "npc-item";
                el.innerHTML = `<div class="npc-icon">${char.name[0]}</div><span>${char.name}</span>`;
                el.onclick = () => {
                    document.getElementById('dossier-name').innerText = char.name;
                    document.getElementById('dossier-desc').innerText = char.description;
                    document.getElementById('dossier-overlay').classList.remove('hidden');
                };
                list.appendChild(el);
            });
        }

        async turn(action) {
            const choicesDiv = document.getElementById('choices-area');
            choicesDiv.innerHTML = '<div class="text-[#00ff41] animate-pulse col-span-2 text-xl">UPLINKING...</div>';

            try {
                const res = await fetch('/api/turn', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        history: state.history,
                        userAction: action,
                        currentStats: state.stats,
                        playerProfile: state.profile,
                        currentCity: state.currentCity,
                        enemyStats: state.enemyStats,
                        language: state.lang,
                        inventory: state.inventory,
                        maxTurns: state.maxTurns,
                        turnCount: state.turnCount
                    })
                });

                const data = await res.json();
                state.turnCount = data.turnCount;
                
                if (data.stats) { state.stats = data.stats; this.renderStats(); }
                if (data.currentCity) {
                    state.currentCity = data.currentCity;
                    if(!state.unlockedCities.includes(data.currentCity)) state.unlockedCities.push(data.currentCity);
                    document.getElementById('current-loc-display').innerText = `LOC: ${state.currentCity.toUpperCase()}`;
                }
                if (data.inventoryUpdates && data.inventoryUpdates.add) {
                    data.inventoryUpdates.add.forEach(i => {
                        if(state.inventory[i.category]) state.inventory[i.category].push(i.item);
                    });
                    this.renderInventory();
                }
                if (data.newCharacters) {
                    data.newCharacters.forEach(nc => {
                        if (!state.knownCharacters.some(k => k.name === nc.name)) state.knownCharacters.push(nc);
                    });
                    this.renderCharacters();
                }

                state.history.push({ role: 'user', content: action || "Start" });
                state.history.push({ role: 'model', content: data.narrative });

                if (data.imageUrl) document.getElementById('img-container').innerHTML = `<img src="${data.imageUrl}" class="w-full h-full object-cover opacity-90 sepia-[.5] hue-rotate-90 contrast-125">`;
                this.typeText(data.narrative);

                if (data.inCombat && data.enemyStats) {
                    state.enemyStats = data.enemyStats;
                    document.getElementById('enemy-hud').classList.remove('hidden');
                    document.getElementById('enemy-hud').classList.add('flex');
                    document.getElementById('enemy-name').innerText = state.enemyStats.name;
                    const pct = (state.enemyStats.hp / state.enemyStats.maxHp) * 100;
                    document.getElementById('enemy-bar').style.width = `${Math.max(0,pct)}%`;
                } else {
                    state.enemyStats = null;
                    document.getElementById('enemy-hud').classList.add('hidden');
                    document.getElementById('enemy-hud').classList.remove('flex');
                }

                choicesDiv.innerHTML = '';
                if(data.isGameOver) {
                    document.getElementById('game-over-screen').classList.remove('hidden');
                    document.getElementById('game-over-screen').classList.add('flex');
                } else if(data.uiLocked) {
                    document.getElementById('puzzle-area').classList.remove('hidden');
                    document.getElementById('puzzle-in').placeholder = data.puzzleQuestion || "SOLVE...";
                } else {
                    document.getElementById('puzzle-area').classList.add('hidden');
                    data.choices.forEach(c => {
                        const btn = document.createElement('button');
                        btn.className = state.enemyStats ? "btn-main border-red-500 text-red-500" : "btn-main";
                        btn.innerText = `> ${c}`;
                        btn.onclick = () => this.turn(c);
                        choicesDiv.appendChild(btn);
                    });
                }
            } catch (e) { console.error(e); choicesDiv.innerText = "CONNECTION FAILURE."; }
        }

        async typeText(text) {
            const el = document.getElementById('story-log');
            const newEntry = document.createElement('div');
            newEntry.className = "mb-6 border-b border-[#002200] pb-4";
            el.appendChild(newEntry);
            
            // Format text: Bold the Names
            let formatted = text.replace(/(\*\*.*?\*\*)/g, '<span class="text-[#00ff41]">$1</span>');
            newEntry.innerHTML = formatted;
            el.scrollTop = el.scrollHeight;
        }

        renderInventory() {
            const list = document.getElementById('inv-list');
            list.innerHTML = '';
            const items = state.inventory[state.activeTab] || [];
            if(items.length === 0) list.innerHTML = '<div class="text-gray-500 italic p-2 text-lg">Empty...</div>';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'inv-item';
                div.innerText = item;
                div.onmouseenter = () => {
                    const desc = DB_LORE[item] || "No data available in database.";
                    document.getElementById('item-info').innerText = desc;
                };
                list.appendChild(div);
            });
        }

        renderMap() {
            const list = document.getElementById('city-list');
            list.innerHTML = '';
            const allCities = ["Neo-Kowloon", "The Scrapyard", "Solaris District", "Trantor Deep", "Ubik Reality", "The Zone", "Gargantus Space"];
            
            allCities.forEach(city => {
                const div = document.createElement('div');
                const isUnlocked = state.unlockedCities.includes(city);
                const isCurrent = state.currentCity === city;
                div.className = `p-3 border mb-3 flex justify-between ${isCurrent ? 'bg-[#00ff41] text-black border-[#00ff41]' : (isUnlocked ? 'border-[#00ff41] hover:bg-[#002200] cursor-pointer' : 'border-[#330000] text-gray-600 opacity-50 cursor-not-allowed')}`;
                div.innerHTML = `<span>${city.toUpperCase()}</span><span>${isCurrent ? 'CURRENT' : (isUnlocked ? 'GO >>' : 'LOCKED')}</span>`;
                if(isUnlocked && !isCurrent) {
                    div.onclick = () => { closeOverlay('map-overlay'); this.turn(`Travel to ${city}.`); };
                }
                list.appendChild(div);
            });
        }

        async fetchSummary() {
            const el = document.getElementById('summary-text');
            el.innerText = "DECRYPTING...";
            try {
                const res = await fetch('/api/summary', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({history: state.history, language: state.lang})
                });
                const data = await res.json();
                el.innerText = data.summary;
            } catch(e) { el.innerText = "ERROR."; }
        }

        function closeOverlay(id) { document.getElementById(id).classList.add('hidden'); }
    }

    window.onload = () => { window.gameInstance = new Game(); };
    </script>
</body>
</html>
